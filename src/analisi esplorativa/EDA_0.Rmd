---
title: "R Notebook"
output: html_notebook
---

# TO DO LIST
- riduce the number of genres-> produce a list

```{r}
library(ggplot2)
library(tidyverse)
library(lubridate)
library(dplyr)
```

```{r}
file_name = "tracks_ettore"
tracks = read.csv(paste0("../../data/",file_name,".csv"),header = T)
dim(tracks)
head(tracks)

# rimuovi una colonna duplicata
tracks = tracks[,-which(colnames(tracks)=="track.duration_ms.1")]
colnames(tracks)
```


# Explore columns
```{r}
for (i in 1:dim(tracks)[2]){
  print(paste0(i,"##",colnames(tracks)[i]))
  print(tracks[1:10,i])
}
```
# Ranges
```{r}
for (i in 5:19){
  print(c(i,colnames(tracks)[i],range(tracks[,i])))
}

numerical_values = c(5:15,17,18)
length(numerical_values)
```


# distributions
```{r}
numerical_values = 5:19
for(col in colnames(tracks)[numerical_values]){
  bins = range(tracks[[col]])[2]-range(tracks[[col]])[1]
  plot <- ggplot(data = tracks, mapping = aes(x =.data[[col]])) +
  geom_histogram(bins =30, fill = "blue", color = "black", alpha = 0.7) +
  labs(title = col, x = "", y = "Frequency") +
  theme_bw()
  
  print(plot)
}

```





# Reduce genre_1
```{r}
length(unique(tracks$genre_1))
tracks$genre_1 <- as.factor(tracks$genre_1)
grouped.genres = c("rock",
                   "alternative",
                   "metal",
                   "death",
                   "psych",
                   "rap",
                   "hop", # hip hop
                   "folk",
                   "jazz",
                   "classic",
                   "pop",
                   "country",
                   "indie",
                   "punk",
                   "soul",
                   "songwriter",
                   "core",
                   "electronic")

tracks_grouped = tracks
for (g in grouped.genres ){
  tracks_grouped$genre_1 <- gsub(paste0(".*",g,".*"), g, tracks_grouped$genre_1, ignore.case = TRUE)
}

# keep only genres with more than "10" elements ( tracks)
freq_table=table(tracks_grouped["genre_1"])
length(unique(tracks_grouped$genre_1))
```

# remove less frequent genres
```{r}
filtered_values <- names(freq_table[freq_table >= 10])
freq_table[filtered_values]

# filter also the original dataset
tracks_filtered = tracks_grouped[tracks_grouped$genre_1 %in% filtered_values,]
```

# Blueprint for plots 
```{r}
plot = ggplot(tracks_filtered, aes(energy,loudness , colour = genre_1 )) + 
  geom_point()+
  theme_bw()+
  theme(legend.position = "none")

print(plot)
```










